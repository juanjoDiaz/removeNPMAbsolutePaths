#!/usr/bin/env node

/* eslint-disable no-console */

'use strict';

const removeNPMAbsolutePaths = require('../src/removeNPMAbsolutePaths');

if (process.argv < 1) {
  console.log('Invalid argument.', 'The first argument should be the path to a directory or a package.json file.');
}

const args = process.argv.slice(2);
const folder = args[0];
const opts = {
  force: false,
};

let inFields = false;

args.slice(1).forEach((arg) => {
  if (arg[0] === '-' && arg[1] === '-') {
    // the only arguments that do not start with dashes are specific fields to
    // be removed and should only come after the --fields argument.  Any other
    // time we see --, we are not processing fields any more
    inFields = false;
  }

  if (arg === '--force') {
    opts.force = true;
  } else if (arg === '--fields') {
    inFields = true;
    opts.fields = [];
  } else if (opts.fields !== undefined && inFields) {
    opts.fields.push(arg);
  }
});

removeNPMAbsolutePaths(folder, opts)
  .then(results => results.forEach((result) => {
    if (!result.success) {
      console.log(result.err.message);
    }
  }))
  .catch(err => console.log(err.message));
